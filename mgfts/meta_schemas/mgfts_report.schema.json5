{
  // Meta-schema for MGFTS_REPORT.json
  // Validates the structure of MGFTS compliance reports

  $schema: "http://json-schema.org/draft-07/schema#",
  $id: "https://mgfts.org/schemas/mgfts_report.schema.json5",
  title: "MGFTS Report Schema",
  description: "Schema for validating MGFTS compliance report files",
  type: "object",

  required: [
    "project",
    "timestamp",
    "tools_run",
    "scores",
    "violations",
    "warnings",
    "concealment_score",
    "coherence_score"
  ],

  properties: {
    project: {
      type: "string",
      description: "Project name or path",
      minLength: 1
    },

    timestamp: {
      type: "string",
      format: "date-time",
      description: "ISO 8601 timestamp of analysis"
    },

    tools_run: {
      type: "array",
      description: "Tools executed during analysis",
      items: {
        type: "object",
        required: ["tool", "version"],
        properties: {
          tool: { type: "string" },
          version: { type: "string" },
          timestamp: { type: "string", format: "date-time" }
        }
      }
    },

    scores: {
      type: "object",
      description: "Compliance scores per layer and overall",
      required: [
        "layer_1_structural",
        "layer_2_governance",
        "layer_3_meta_schema",
        "layer_4_semantic",
        "layer_5_ecological",
        "layer_6_formal",
        "layer_7_ontological",
        "overall"
      ],
      properties: {
        layer_1_structural: { $ref: "#/definitions/score" },
        layer_2_governance: { $ref: "#/definitions/score" },
        layer_3_meta_schema: { $ref: "#/definitions/score" },
        layer_4_semantic: { $ref: "#/definitions/score" },
        layer_5_ecological: { $ref: "#/definitions/score" },
        layer_6_formal: { $ref: "#/definitions/score" },
        layer_7_ontological: { $ref: "#/definitions/score" },
        overall: { $ref: "#/definitions/score" }
      }
    },

    violations: {
      type: "array",
      description: "Compliance violations",
      items: { $ref: "#/definitions/issue" }
    },

    warnings: {
      type: "array",
      description: "Compliance warnings",
      items: { $ref: "#/definitions/issue" }
    },

    concepts_missing: {
      type: "array",
      description: "Concepts referenced but not defined",
      items: { type: "string" },
      uniqueItems: true
    },

    concepts_unused: {
      type: "array",
      description: "Concepts defined but never referenced",
      items: { type: "string" },
      uniqueItems: true
    },

    concealment_score: {
      $ref: "#/definitions/score",
      description: "Concealment Functional score (higher = more concealment)"
    },

    coherence_score: {
      $ref: "#/definitions/score",
      description: "Coherence Field score (higher = more coherent)"
    },

    metrics: {
      type: "object",
      description: "Additional metrics from tools",
      additionalProperties: true
    },

    summary: {
      type: "object",
      description: "Summary statistics",
      properties: {
        total_violations: { type: "integer", minimum: 0 },
        total_warnings: { type: "integer", minimum: 0 },
        critical_violations: { type: "integer", minimum: 0 },
        high_violations: { type: "integer", minimum: 0 }
      }
    }
  },

  definitions: {
    score: {
      type: "number",
      minimum: 0.0,
      maximum: 1.0,
      description: "Compliance score from 0 (fail) to 1 (perfect)"
    },

    issue: {
      type: "object",
      required: ["code", "message", "path", "severity"],
      properties: {
        code: {
          type: "string",
          pattern: "^[A-Z_]+$",
          description: "Issue code in SCREAMING_SNAKE_CASE"
        },

        message: {
          type: "string",
          minLength: 1,
          description: "Human-readable description"
        },

        path: {
          type: "string",
          description: "Relative file path from project root"
        },

        severity: {
          type: "string",
          enum: ["critical", "high", "medium", "low"],
          description: "Issue severity level"
        },

        layer: {
          type: "integer",
          minimum: 1,
          maximum: 7,
          description: "MGFTS layer number"
        },

        tool: {
          type: "string",
          description: "Tool that reported this issue"
        }
      }
    }
  }
}
